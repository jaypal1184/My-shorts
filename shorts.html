<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Shorts</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', Arial, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            touch-action: pan-y;
        }
        
        /* Top Navigation */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .logo {
            font-weight: bold;
            font-size: 20px;
            color: #ff0000;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background-color: #222;
            border-radius: 20px;
            padding: 5px 15px;
            width: 60%;
        }
        
        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            padding: 5px;
            width: 100%;
            outline: none;
        }
        
        /* Shorts Container */
        .shorts-feed {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            -webkit-overflow-scrolling: touch;
        }
        
        .shorts-container {
            height: 100vh;
            width: 100%;
            position: relative;
            scroll-snap-align: start;
        }
        
        .video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .video-container video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Video Info */
        .video-info {
            position: absolute;
            bottom: 80px;
            left: 10px;
            right: 10px;
            z-index: 10;
        }
        
        .video-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .video-stats {
            font-size: 14px;
            color: #aaa;
            margin-bottom: 15px;
        }
        
        /* Creator Info */
        .creator-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .creator-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }
        
        .creator-name {
            font-size: 14px;
            font-weight: 500;
            margin-right: 10px;
        }
        
        .subscribe-btn {
            background-color: #ff0000;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .subscribed-btn {
            background-color: #606060;
            color: white;
        }
        
        /* Right Action Buttons */
        .action-buttons {
            position: absolute;
            right: 10px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .action-icon {
            background-color: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .action-count {
            font-size: 12px;
            color: #fff;
        }
        
        /* Music Info */
        .music-info {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
            width: fit-content;
        }
        
        .music-icon {
            margin-right: 8px;
        }
        
        .music-name {
            font-size: 12px;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #000;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            font-size: 10px;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="logo">My Shorts</div>
        <div class="search-bar">
            <input type="text" placeholder="Search">
            <span class="material-icons">search</span>
        </div>
    </div>
    
    <!-- Shorts Feed with Multiple Videos -->
    <div class="shorts-feed" id="shortsFeed">
        <!-- Shorts will be loaded dynamically from Firebase -->
    </div>
    
    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-btn">
            <span class="material-icons nav-icon">home</span>
            <div>Home</div>
        </div>
        <div class="nav-btn">
            <span class="material-icons nav-icon">explore</span>
            <div>Explore</div>
        </div>
        <div class="nav-btn">
            <span class="material-icons nav-icon">add_circle_outline</span>
            <div>Create</div>
        </div>
        <div class="nav-btn">
            <span class="material-icons nav-icon">subscriptions</span>
            <div>Subscriptions</div>
        </div>
        <div class="nav-btn">
            <span class="material-icons nav-icon">video_library</span>
            <div>Library</div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const shortsFeed = document.getElementById('shortsFeed');

        // User state
        let currentUser = null;
        let subscriptions = [];

        // Initialize the app
        function initApp() {
            // Listen for auth state changes
            auth.onAuthStateChanged(user => {
                currentUser = user;
                if (user) {
                    // Load user subscriptions
                    loadSubscriptions();
                }
                // Load shorts regardless of auth state
                loadShorts();
            });
        }

        // Load subscriptions from Firestore
        function loadSubscriptions() {
            db.collection('users').doc(currentUser.uid).collection('subscriptions')
                .onSnapshot(snapshot => {
                    subscriptions = [];
                    snapshot.forEach(doc => {
                        subscriptions.push(doc.id);
                    });
                    // Update subscribe buttons
                    updateSubscribeButtons();
                });
        }

        // Load shorts from Firestore
        function loadShorts() {
            db.collection('shorts').orderBy('timestamp', 'desc').limit(10)
                .onSnapshot(snapshot => {
                    shortsFeed.innerHTML = '';
                    snapshot.forEach(doc => {
                        const short = doc.data();
                        addShortToFeed(short, doc.id);
                    });
                    // Initialize video autoplay
                    initVideoAutoplay();
                });
        }

        // Add short to the feed
        function addShortToFeed(short, shortId) {
            const shortElement = document.createElement('div');
            shortElement.className = 'shorts-container';
            shortElement.dataset.shortId = shortId;
            
            shortElement.innerHTML = `
                <div class="video-container">
                    <video autoplay loop muted playsinline>
                        <source src="${short.videoUrl}" type="video/mp4">
                    </video>
                </div>
                
                <div class="video-info">
                    <div class="video-title">${short.title}</div>
                    <div class="video-stats">${formatNumber(short.views)} views</div>
                    
                    <div class="creator-info">
                        <img src="${short.creatorAvatar}" alt="Creator" class="creator-avatar">
                        <div class="creator-name">${short.creatorName}</div>
                        <button class="subscribe-btn" data-creator-id="${short.creatorId}">Subscribe</button>
                    </div>
                    
                    <div class="music-info">
                        <span class="material-icons music-icon">music_note</span>
                        <div class="music-name">${short.music}</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <div class="action-btn like-btn" data-short-id="${shortId}">
                        <div class="action-icon">
                            <span class="material-icons like-icon">thumb_up</span>
                        </div>
                        <div class="action-count like-count">${formatNumber(short.likes)}</div>
                    </div>
                    
                    <div class="action-btn">
                        <div class="action-icon">
                            <span class="material-icons">thumb_down</span>
                        </div>
                        <div class="action-count">Dislike</div>
                    </div>
                    
                    <div class="action-btn">
                        <div class="action-icon">
                            <span class="material-icons">comment</span>
                        </div>
                        <div class="action-count">${formatNumber(short.comments)}</div>
                    </div>
                    
                    <div class="action-btn">
                        <div class="action-icon">
                            <span class="material-icons">share</span>
                        </div>
                        <div class="action-count">Share</div>
                    </div>
                    
                    <div class="action-btn">
                        <div class="action-icon">
                            <span class="material-icons">more_vert</span>
                        </div>
                    </div>
                </div>
            `;
            
            shortsFeed.appendChild(shortElement);
            
            // Add event listeners
            const likeBtn = shortElement.querySelector('.like-btn');
            const subscribeBtn = shortElement.querySelector('.subscribe-btn');
            
            likeBtn.addEventListener('click', handleLike);
            subscribeBtn.addEventListener('click', handleSubscribe);
        }

        // Handle like action
        function handleLike(e) {
            if (!currentUser) {
                alert('Please sign in to like videos');
                return;
            }
            
            const shortId = e.currentTarget.dataset.shortId;
            const likeIcon = e.currentTarget.querySelector('.like-icon');
            const likeCountElement = e.currentTarget.querySelector('.like-count');
            let likeCount = parseInt(likeCountElement.textContent.replace(/,/g, ''));
            
            // Check if already liked
            db.collection('shorts').doc(shortId).collection('likes').doc(currentUser.uid)
                .get()
                .then(doc => {
                    if (doc.exists) {
                        // Unlike
                        db.collection('shorts').doc(shortId).collection('likes').doc(currentUser.uid).delete();
                        db.collection('shorts').doc(shortId).update({
                            likes: firebase.firestore.FieldValue.increment(-1)
                        });
                        likeIcon.style.color = '#fff';
                        likeCountElement.textContent = formatNumber(likeCount - 1);
                    } else {
                        // Like
                        db.collection('shorts').doc(shortId).collection('likes').doc(currentUser.uid).set({
                            timestamp: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        db.collection('shorts').doc(shortId).update({
                            likes: firebase.firestore.FieldValue.increment(1)
                        });
                        likeIcon.style.color = '#ff0000';
                        likeCountElement.textContent = formatNumber(likeCount + 1);
                    }
                });
        }

        // Handle subscribe action
        function handleSubscribe(e) {
            if (!currentUser) {
                alert('Please sign in to subscribe');
                return;
            }
            
            const creatorId = e.currentTarget.dataset.creatorId;
            const isSubscribed = subscriptions.includes(creatorId);
            
            if (isSubscribed) {
                // Unsubscribe
                db.collection('users').doc(currentUser.uid).collection('subscriptions').doc(creatorId).delete();
                e.target.textContent = 'Subscribe';
                e.target.classList.remove('subscribed-btn');
                e.target.style.backgroundColor = '#ff0000';
            } else {
                // Subscribe
                db.collection('users').doc(currentUser.uid).collection('subscriptions').doc(creatorId).set({
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                e.target.textContent = 'Subscribed';
                e.target.classList.add('subscribed-btn');
                e.target.style.backgroundColor = '#606060';
            }
        }

        // Update subscribe buttons based on current subscriptions
        function updateSubscribeButtons() {
            document.querySelectorAll('.subscribe-btn').forEach(btn => {
                const creatorId = btn.dataset.creatorId;
                if (subscriptions.includes(creatorId)) {
                    btn.textContent = 'Subscribed';
                    btn.classList.add('subscribed-btn');
                    btn.style.backgroundColor = '#606060';
                } else {
                    btn.textContent = 'Subscribe';
                    btn.classList.remove('subscribed-btn');
                    btn.style.backgroundColor = '#ff0000';
                }
            });
        }

        // Initialize video autoplay
        function initVideoAutoplay() {
            const videos = document.querySelectorAll('video');
            
            function handleScroll() {
                const feedRect = shortsFeed.getBoundingClientRect();
                
                videos.forEach(video => {
                    const videoRect = video.getBoundingClientRect();
                    
                    // Check if at least 50% of video is visible
                    if (videoRect.top >= feedRect.top - (videoRect.height * 0.5) && 
                        videoRect.bottom <= feedRect.bottom + (videoRect.height * 0.5)) {
                        video.play();
                    } else {
                        video.pause();
                    }
                });
            }
            
            // Debounce scroll events for performance
            let isScrolling;
            shortsFeed.addEventListener('scroll', () => {
                window.clearTimeout(isScrolling);
                isScrolling = setTimeout(handleScroll, 100);
            });
            
            // Initial check
            handleScroll();
        }

        // Format numbers (1000 -> 1K)
        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            }
            if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Initialize the app
        initApp();
    </script>
</body>
  </html>
